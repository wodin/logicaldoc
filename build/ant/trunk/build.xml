<!--   This is a general and build that collects common targets -->
<project name="logicaldoc" default="init-all" basedir="."  xmlns:artifact="urn:maven-artifact-ant">
  <property environment="env" />
  <property file="${user.home}/logicaldoc-dev.properties" />
  <path id="ext.classpath">
    <fileset dir="${logicaldoc.devroot}/build/ant/lib">
      <include name="*.jar"/>
    </fileset>
  </path>
  <target name="task-definitions">
    <taskdef resource="net/sf/antcontrib/antlib.xml">
      <classpath refid="ext.classpath" />
    </taskdef>
    <typedef resource="org/apache/maven/artifact/ant/antlib.xml" uri="urn:maven-artifact-ant">
      <classpath refid="ext.classpath" />
    </typedef>
    <path id="hibernate.classpath">
      <fileset dir="${logicaldoc.hibernate.home}">
        <include name="**/*.jar" />
      </fileset>
      <fileset dir="${logicaldoc.devroot}/build/ant/lib">
        <include name="*.jar"/>
      </fileset>
      <pathelement path="target/classes" />
    </path>
    <echo>${logicaldoc.devroot}</echo>
    <trycatch  property="error" reference="exception">
      <try>
        <taskdef name="schemaexport" classname="org.hibernate.tool.hbm2ddl.SchemaExportTask" classpathref="hibernate.classpath" />
      </try>
      <catch>
        <echo>${error}</echo>
      </catch>
    </trycatch>
  </target>
  <target name="init-all" depends="task-definitions">
    <trycatch property="error" reference="exception">
      <try>
        <artifact:pom file="pom.xml" id="pom" />
      </try>
      <catch>
        <echo>${error}</echo>
      </catch>
    </trycatch>
    <echo>LogicalDOC environment ready</echo>
  </target>
  <target name="schema-export" depends="init-all" description="Sql schema creation from Hibernate mappings">
    <schemaexport quiet="no" text="yes" drop="no" delimiter=";" output="target/schema-export.sql">
      <fileset dir="${logicaldoc.devroot}">
        <include name="**/src/main/resources/mappings/*.hbm.xml" />
      </fileset>
    </schemaexport>
  </target>
  <target name="prepare-sql">
    <copy todir="${logicaldoc.devroot}/logicaldoc-sql" flatten="true">
      <fileset dir="${logicaldoc.devroot}">
        <include name="**/src/main/resources/**/*.sql*" />
      </fileset>
    </copy>
    <zip destfile="${logicaldoc.devroot}/logicaldoc-sql.zip" basedir="${logicaldoc.devroot}/logicaldoc-sql"   />
    <delete dir="${logicaldoc.devroot}/logicaldoc-sql"/>
  </target>
  <target name="prepare-src">
    <copy todir="${logicaldoc.devroot}/logicaldoc-src">
      <fileset dir="${logicaldoc.devroot}">
        <include name="build/**" />
        <include name="community/**" />
        <exclude name="**/target/**" />
        <exclude name="**/.*/**" />
        <!--include name="enterprise/**" /-->
      </fileset>
    </copy>
    <copy todir="${logicaldoc.devroot}/logicaldoc-src" file="${logicaldoc.devroot}/build/ant/README.txt" />
    <zip destfile="${logicaldoc.devroot}/logicaldoc-src.zip" basedir="${logicaldoc.devroot}/logicaldoc-src"   />
    <delete dir="${logicaldoc.devroot}/logicaldoc-src"/>
  </target>
</project>