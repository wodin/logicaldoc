<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN 2.0//EN" "http://www.springframework.org/dtd/spring-beans-2.0.dtd">
<beans>

	<!--
		*************************** 
		* Apache Directory Server * 
		***************************
		Version: 1.3.0.v20081020
	-->
	<bean id="LDAPUserGroupContext"
		class="com.logicaldoc.authentication.ldap.LDAPUserGroupContext">
		<property name="userIdentiferAttribute"
			value="${ldap.userIdentiferAttribute}" />
		<property name="logonAttribute" value="${ldap.logonAttribute}" />
		<property name="userClass" value="${ldap.userClass}" />
		<property name="groupClass" value="${ldap.groupClass}" />
		<property name="groupIdentiferAttribute"
			value="${ldap.groupIdentiferAttribute}" />
		<property name="userBaseString" value="${ldap.userBase}" />
		<property name="groupBaseString" value="${ldap.groupBase}" />
	</bean>

	<bean id="LDAPContextSourceConfig"
		class="com.logicaldoc.authentication.ldap.LDAPContextSourceConfig">
		<property name="url" value="${ldap.url}" />
		<property name="realm" value="${ldap.realm}" />
		<property name="currentDN" value="${ldap.currentDN}" />
		<property name="userAuthenticationPattern"
			value="${ldap.authenticationPattern}" />
		<property name="userName" value="${ldap.username}" />
		<property name="password" value="${ldap.password}" />
		<property name="base" value="${ldap.base}" />
		<property name="enabled" value="${ldap.enabled}" />
	</bean>

	<!-- 
		Simple Authentication
	-->
	<bean id="LDAPContextSource"
		class="com.logicaldoc.authentication.ldap.BasicLDAPContextSource"
		scope="prototype">
		<property name="configuration" ref="LDAPContextSourceConfig" />
		<property name="userGroupContext" ref="LDAPUserGroupContext" />
	</bean>


	<!-- 
		******************** 
		* Active Directory * 
		********************
		Version: Windows Server 2003 Professional SP2
	-->
	<bean id="ADUserGroupContext"
		class="com.logicaldoc.authentication.ldap.LDAPUserGroupContext">
		<property name="userIdentiferAttribute"
			value="${ad.userIdentiferAttribute}" />
		<property name="logonAttribute" value="${ad.logonAttribute}" />
		<property name="userClass" value="${ad.userClass}" />
		<property name="groupClass" value="${ad.groupClass}" />
		<property name="groupIdentiferAttribute"
			value="${ad.groupIdentiferAttribute}" />
		<property name="userBaseString" value="${ad.userBase}" />
		<property name="groupBaseString" value="${ad.groupBase}" />
	</bean>

	<bean id="ADContextSourceConfig"
		class="com.logicaldoc.authentication.ldap.LDAPContextSourceConfig">
		<property name="url" value="${ad.url}" />
		<property name="realm" value="${ad.realm}" />
		<property name="currentDN" value="${ad.currentDN}" />
		<property name="userAuthenticationPattern"
			value="${ad.authenticationPattern}" />
		<property name="userName" value="${ad.username}" />
		<property name="password" value="${ad.password}" />
		<property name="base" value="${ad.base}" />
		<property name="enabled" value="${ad.enabled}" />
	</bean>

	<bean id="ADContextSource"
		class="com.logicaldoc.authentication.ldap.BasicLDAPContextSource"
		scope="prototype">
		<property name="configuration" ref="ADContextSourceConfig" />
		<property name="userGroupContext" ref="ADUserGroupContext" />
	</bean>

	<!-- 
		DIGEST-MD5 Authentication
	-->
	<!-- 
		<bean id="LDAPContextSource"
		class="com.logicaldoc.authentication.ldap.DigestMD5LdapContextSource" scope="prototype">
		<property name="url" value="ldap://logicaldoc:389/DC=logicalobjects" />
		<property name="base" value="" />
		<property name="realm" value="logicalobjects"/>
		<property name="userName" value="swenzky" />
		<property name="password" value="Test1234" />>
		</bean>
	-->

	<!-- 		
		LDAP Core Implementations! Please be warrent: Customizing only if you know what you are doing! 
	-->
	<bean id="LdapTemplate"
		class="org.springframework.ldap.LdapTemplate" scope="prototype">
		<constructor-arg ref="LDAPContextSource" />
	</bean>

	<bean id="basicUserMapper"
		class="com.logicaldoc.authentication.ldap.UserAttributeMapper">
		<property name="ldapUserGroupContext"
			ref="LDAPUserGroupContext" />
	</bean>

	<bean id="basicGroupMapper"
		class="com.logicaldoc.authentication.ldap.GroupAttributeMapper">
	</bean>

	<bean id="UserGroupDAO"
		class="com.logicaldoc.authentication.ldap.UserGroupDAO">
		<property name="ldapUserGroupContext"
			ref="LDAPUserGroupContext" />
		<property name="ldapTemplate" ref="LdapTemplate" />
		<property name="userMapper" ref="basicUserMapper" />
		<property name="groupMapper" ref="basicGroupMapper" />
	</bean>

	<bean id="LDAPAuthentication"
		class="com.logicaldoc.authentication.ldap.LDAPAuthentication">
		<lookup-method name="obtainNewLdapContextSource"
			bean="LDAPContextSource" />
		<property name="ldapUserGroupContext"
			ref="LDAPUserGroupContext" />
		<property name="userGroupDao" ref="UserGroupDAO" />
		<property name="synchroniser" ref="LDAPSynchroniser" />
		<property name="userDao" ref="UserDAO" />
		<property name="config" ref="LDAPContextSourceConfig" />
		<property name="notValidatedUsers">
			<list>
				<value>admin</value>
			</list>
		</property>
	</bean>

	<bean id="ADAuthentication"
		class="com.logicaldoc.authentication.ldap.LDAPAuthentication">
		<lookup-method name="obtainNewLdapContextSource"
			bean="ADContextSource" />
		<property name="ldapUserGroupContext" ref="ADUserGroupContext" />
		<property name="userGroupDao" ref="UserGroupDAO" />
		<property name="synchroniser" ref="LDAPSynchroniser" />
		<property name="userDao" ref="UserDAO" />
		<property name="config" ref="ADContextSourceConfig" />
		<property name="notValidatedUsers">
			<list>
				<value>admin</value>
			</list>
		</property>
	</bean>


	<bean id="LDAPSynchroniser"
		class="com.logicaldoc.authentication.ldap.LDAPSynchroniser">
		<property name="userDao" ref="UserDAO" />
		<property name="groupDao" ref="GroupDAO" />
		<property name="userGroupDao" ref="UserGroupDAO" />
	</bean>

	<bean id="LDAPSynchroniserJob"
		class="org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean">
		<property name="targetObject" ref="LDAPSynchroniser" />
		<property name="targetMethod">
			<value>run</value>
		</property>
		<property name="concurrent">
			<value>false</value>
		</property>
	</bean>

	<bean id="LDAPSynchroniserTrigger"
		class="com.logicaldoc.util.quartz.DoubleTrigger">
		<property name="jobDetail" ref="LDAPSynchroniserJob" />
		<property name="cronTrigger" ref="CronLDAPSynchroniserTrigger" />
		<property name="simpleTrigger"
			ref="SimpleLDAPSynchroniserTrigger" />
		<property name="mode" value="${schedule.mode.LDAPSynchroniser}" />
	</bean>

	<bean id="CronLDAPSynchroniserTrigger"
		class="org.springframework.scheduling.quartz.CronTriggerBean">
		<property name="jobDetail" ref="LDAPSynchroniserJob" />
		<property name="cronExpression"
			value="${schedule.cron.LDAPSynchroniser}" />
	</bean>

	<bean id="SimpleLDAPSynchroniserTrigger"
		class="org.springframework.scheduling.quartz.SimpleTriggerBean">
		<property name="jobDetail" ref="LDAPSynchroniserJob" />
		<property name="startDelay"
			value="${schedule.delay.LDAPSynchroniser}" />
		<property name="repeatInterval"
			value="${schedule.interval.LDAPSynchroniser}" />
	</bean>


	<bean id="ADSynchroniser"
		class="com.logicaldoc.authentication.ldap.ADSynchroniser">
		<property name="userDao" ref="UserDAO" />
		<property name="groupDao" ref="GroupDAO" />
		<property name="userGroupDao" ref="UserGroupDAO" />
	</bean>

	<bean id="ADSynchroniserJob"
		class="org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean">
		<property name="targetObject" ref="ADSynchroniser" />
		<property name="targetMethod">
			<value>run</value>
		</property>
		<property name="concurrent">
			<value>false</value>
		</property>
	</bean>

	<bean id="ADSynchroniserTrigger"
		class="com.logicaldoc.util.quartz.DoubleTrigger">
		<property name="jobDetail" ref="ADSynchroniserJob" />
		<property name="cronTrigger" ref="CronADSynchroniserTrigger" />
		<property name="simpleTrigger"
			ref="SimpleADSynchroniserTrigger" />
		<property name="mode" value="${schedule.mode.ADSynchroniser}" />
	</bean>

	<bean id="CronADSynchroniserTrigger"
		class="org.springframework.scheduling.quartz.CronTriggerBean">
		<property name="jobDetail" ref="ADSynchroniserJob" />
		<property name="cronExpression"
			value="${schedule.cron.ADSynchroniser}" />
	</bean>

	<bean id="SimpleADSynchroniserTrigger"
		class="org.springframework.scheduling.quartz.SimpleTriggerBean">
		<property name="jobDetail" ref="ADSynchroniserJob" />
		<property name="startDelay"
			value="${schedule.delay.ADSynchroniser}" />
		<property name="repeatInterval"
			value="${schedule.interval.ADSynchroniser}" />
	</bean>


	<bean id="LdapBean"
		class="com.logicaldoc.authentication.web.LdapBean" scope="session">
		<property name="userGroupContext" ref="LDAPUserGroupContext" />
		<property name="contextSourceConfig"
			ref="LDAPContextSourceConfig" />
	</bean>
	<bean id="ActiveDirBean"
		class="com.logicaldoc.authentication.web.LdapBean" scope="session">
		<property name="userGroupContext" ref="ADUserGroupContext" />
		<property name="contextSourceConfig"
			ref="ADContextSourceConfig" />
		<property name="propertyPrefix" value="ad" />
	</bean>
</beans>